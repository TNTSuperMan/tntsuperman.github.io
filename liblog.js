(()=>{"use strict";let e;const t=window.document,n=e=>t.createElement(e),a=e=>{"loading"==t.readyState?t.addEventListener("DOMContentLoaded",(()=>e())):e()};function o(e,t){let n=e;return t.text.forEach((e=>n=e(n))),n}function i(e,t){const n=["",""];let a=1;for(let o=1;o<e.length;o++)("\\"!=t&&"\\"==e[o]||"/"==e[o])&&o!=e.length-1&&e[o+1]==t?(n[a]+=t,o++):e[o]==t?(n.push(""),a++):n[a]+=e[o];return n}const c=function e(a,c,r,s,l){const p=[c];let h,d,u,f=!1,m=!1;const b=()=>p[p.length-1],g=a.split("\r").join("").split("\n");if(l){c.innerHTML="";const e=t.querySelector("title");e&&(e.textContent=g[0])}let k,w,y,E;g.forEach((t=>{if("+"==t[0]&&(m=!1),m)b().innerHTML+=t+"\n";else switch("/"==t[0]&&"/"!=t[1]||(f&&p.pop(),f=!1),":"!=t[0]&&"="!=t[0]&&(h=null),t[0]){case"/":if("/"===t[1])break;f?b().innerHTML+="<br>":(u=n("p"),b().appendChild(u),p.push(u),f=!0),b().innerHTML+=t.substring(1);break;case":":if(d=i(t,":"),d.length<3)break;d=o(d,s),k=n(d[1]),k.innerHTML=d[2],h=k,b().appendChild(k);break;case"=":if(d=i(t,"="),d.length<3)break;d=o(d,s),h?h.setAttribute(d[1],d[2]):b().setAttribute(d[1],d[2]);break;case"\\":if(d=i(t,"\\"),d.length<2)break;if(d=o(d,s),w=r.find((e=>e.name==d[1])),!w)break;y=w.base,d.forEach(((e,t)=>{t<2||y&&(y=y.replaceAll("%"+(t-1),e))})),e(y,b(),r,s,!1);break;case"&":b().innerHTML+=t.substring(1);break;case"-":if(d=t.split("-"),d.length<2)break;k=n(d[1]),b().appendChild(k),p.push(k),d.length>2&&"DIRECT"===d[2]&&(m=!0);break;case"+":m=!1,p.pop();break;case"@":if(d=i(t,"@"),d.length<2)break;if(E=s.component.find((e=>e[1]==d[1])),!E)break;E[0](d.toSpliced(0,2),(e=>b().appendChild(e)))}}))};(async()=>{(()=>{const e="https://github.com/TNTSuperMan/liblog.js",n="Powered by liblog.js by TNTSuperMan.";a((()=>{const a=t.querySelector("html");if(a){const o=a.parentNode;o&&(o.prepend(t.createComment(e)),o.prepend(t.createComment(n)))}})),console.log("%c "+n,"font-size:20px"),console.log(e)})();const o=await(async()=>{const e=await fetch("config.json"),n=await e.json().catch((()=>(e=>{throw void alert("liblog.jsでエラーが発生しました。\n管理者に問い合わせてください。")})()));return a((()=>{if(n.icon){const e=t.createElement("link"),a=t.createElement("link");e.rel="shortcut icon",a.rel="icon",e.href=n.icon,a.href=n.icon,t.head.appendChild(e),t.head.appendChild(a)}})),n})(),i=(n=>{const a=[],o=[],i=[];return n.pagestruct.forEach((c=>{let r=c.default;if("main"==c.id){const e=new URLSearchParams(window.location.search).get("p");e&&(r=n.path.first+e+n.path.last)}const s=t.createElement(c.ename);t.body.appendChild(s),c.attr&&c.attr.forEach((e=>s.setAttribute(e.name,e.value))),"main"==c.id&&(t=>{e=t})(s),o.push(s),a.push(fetch(r).then((e=>e.ok?e.text():n.notfound)).catch((()=>n.notfound))),i.push(c.id)})),{text:a,elms:o,ids:i}})(o),r=await(async e=>{const t={text:[],component:[]};if(e.plugin){const n=e.plugin?.map((e=>import(e).then((async e=>{switch(e.mode){case"text":t.text.push(e.func);break;case"component":t.component.push([e.func,e.name]);break;default:return}{const t=e.init();t instanceof Promise&&await t}}))));await Promise.all(n)}return t})(o);a((async()=>{t.head.appendChild(n("title"));const e=await Promise.all(i.text);i.elms.forEach(((t,n)=>c(e[n],t,o.temp??[],r,"main"==i.ids[n])));const a=t.getElementById(new URLSearchParams(window.location.search).get("s")??"");a&&(t.documentElement.scrollTop+=a.getBoundingClientRect().y)})),Object.defineProperty(window,"l",{get:()=>n=>((n,a,o,i)=>{history.replaceState("","","?p="+n),fetch(a.path.first+n+a.path.last).then((e=>e.ok?e.text():a.notfound)).then((n=>{t.documentElement.scrollTop=0,c(n,e,o,i,!0)}))})(n,o,o.temp??[],r)})})()})();